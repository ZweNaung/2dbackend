require('dotenv').config();const luckyModel = require("../model/luckyModel");const {PutObjectCommand, S3Client, DeleteObjectCommand} = require('@aws-sdk/client-s3');const s3Client = new S3Client({    region:"auto",    endpoint: process.env.R2_ENDPOINT,    credentials: {        accessKeyId: process.env.R2_ACCESS_KEY_ID,        secretAccessKey: process.env.R2_SECRET_ACCESS_KEY,    }})//-----Upload----const luckyUpload = async (req,res) => {    try{        const {name} = req.body;        if(!name || !req.file){            return res.status(400).json({ error: "Missing required field" });        }        const fileName = `lucky/${Date.now()}-${req.file.originalname}`;        const command = new PutObjectCommand({            Bucket: process.env.R2_BUCKET_NAME,            Key:fileName,            Body: req.file.buffer,            ContentType :req.file.mimetype,        })        await  s3Client.send(command);        const publicUrl = `${process.env.R2_PUBLIC_DOMAIN}/${fileName}`;        const newLuckyData = new luckyModel({            name: name,            imgUrl: publicUrl,        })        const saveData = await newLuckyData.save();        res.status(201).json({            success: true,            message: 'Successfully Upload',            data: saveData,        });    }catch(err){        console.error("--Real Error Start")        console.error(err)        console.error("--Real Error End")        res.status(500).json({error:"An error occurred on the server while inserting data."});    }}//GetAll Luckyconst getAllLucky = async (req,res) => {    try {        const allLucky = await luckyModel.find({})        res.status(200).json({            success: true,            message: 'Fetch Data Successfully',            data: allLucky        })    }catch (err){        res.status(500).json({error:"An error occurred on the server while inserting data."});    }}//delete luckyconst deleteLucky = async (req,res) => {    try {        const {id} = req.params;        const luckyToDelete = await luckyModel.findById(id);        if(!luckyToDelete){return res.status(404).json({error:"Lucky Not Found"})}        if(luckyToDelete.imgUrl){            const urlParts = luckyToDelete.imgUrl.split("/")            const fileName = urlParts.slice(-2).join('/');            const command = new DeleteObjectCommand({                Bucket: process.env.R2_BUCKET_NAME,                Key:fileName,            })            console.log("Bucket Name:", process.env.R2_BUCKET_NAME);            await s3Client.send(command)        }        await luckyModel.findByIdAndDelete(id)        res.status(200).json({            success: true,            message: 'Successfully Deleted',            name: luckyToDelete.name,        })    }catch(err){        console.error(err);        res.status(500).json({ error: "An error occurred while deleting data." });    }}module.exports ={    luckyUpload,    getAllLucky,    deleteLucky}